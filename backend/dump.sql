DROP TABLE BETS;
DROP TABLE TRANSACTIONS;
DROP TABLE EVENTS;
DROP TABLE CREDIT_CARD;
DROP TABLE ACCOUNTS;
DROP TABLE WALLETS;
DROP TABLE ADMIN_ACCOUNTS;
DROP SEQUENCE SEQ_ACCOUNTSPK;
DROP SEQUENCE SEQ_WALLETSPK;
DROP SEQUENCE SEQ_WALLETSFK;
DROP SEQUENCE SEQ_BETSPK;
DROP SEQUENCE SEQ_EVENTSPK;
DROP SEQUENCE SEQ_TRANSACTIONSPK;

CREATE TABLE ADMIN_ACCOUNTS (
    id_adm NUMBER PRIMARY KEY,
    email VARCHAR2(255),
    senha VARCHAR2(255)
);

CREATE TABLE ACCOUNTS (
    id_usr NUMBER PRIMARY KEY,
    fk_id_crt NUMBER,
    nome VARCHAR2(255),
    email VARCHAR2(255) UNIQUE,
    senha VARCHAR2(255),
    data_nasc VARCHAR2(10),
    token VARCHAR2(255)
);

CREATE TABLE WALLETS (
    id_crt NUMBER PRIMARY KEY,
    saldo NUMBER
);

CREATE TABLE CREDIT_CARD (
    num_card NUMBER PRIMARY KEY,
    fk_id_crt NUMBER,
    cvv NUMBER,
    validade VARCHAR2(7)
);

CREATE TABLE EVENTS (
    id_evt NUMBER PRIMARY KEY,
    fk_id_usr NUMBER,
    titulo VARCHAR2(255),
    descricao VARCHAR2(1000),
    categoria VARCHAR2(255),
    data_inicio VARCHAR2(10),
    data_fim VARCHAR2(10),
    data_evt VARCHAR2(10),
    status VARCHAR2(30),
    valor_cota NUMBER
);

CREATE TABLE BETS (
    id_apt NUMBER PRIMARY KEY,
    qtd_cotas NUMBER,
    fk_id_evt NUMBER,
    fk_id_usr NUMBER,
    escolha VARCHAR2(255)
);

CREATE TABLE TRANSACTIONS(
    id_trs NUMBER PRIMARY KEY,
    tipo VARCHAR2(50),
    data_trs VARCHAR2(10),
    valor NUMBER,
    fk_id_usr NUMBER
);

ALTER TABLE ACCOUNTS ADD CONSTRAINT FK_USUARIO_CARTEIRA
    FOREIGN KEY (fk_id_crt)
    REFERENCES WALLETS (id_crt);

ALTER TABLE CREDIT_CARD ADD CONSTRAINT FK_CARTAO_CARTEIRA
    FOREIGN KEY (fk_id_crt)
    REFERENCES WALLETS (id_crt);

ALTER TABLE BETS ADD CONSTRAINT FK_APOSTAS_EVENTO
    FOREIGN KEY (fk_id_evt)
    REFERENCES EVENTS (id_evt);

ALTER TABLE BETS ADD CONSTRAINT FK_APOSTAS_USUARIO
    FOREIGN KEY (fk_id_usr)
    REFERENCES ACCOUNTS (id_usr);
    
ALTER TABLE EVENTS ADD CONSTRAINT FK_USUARIO_EVENTO
    FOREIGN KEY (fk_id_usr)
    REFERENCES ACCOUNTS (id_usr);
    
ALTER TABLE TRANSACTIONS ADD CONSTRAINT FK_USUARIO_TRANSACTIONS
    FOREIGN KEY (fk_id_usr)
    REFERENCES ACCOUNTS (id_usr);

CREATE SEQUENCE SEQ_ACCOUNTSPK START WITH 1
INCREMENT BY 1;
CREATE SEQUENCE SEQ_WALLETSPK START WITH 1
INCREMENT BY 1;
CREATE SEQUENCE SEQ_WALLETSFK START WITH 1
INCREMENT BY 1;
CREATE SEQUENCE SEQ_BETSPK START WITH 1
INCREMENT BY 1;
CREATE SEQUENCE SEQ_EVENTSPK START WITH 1
INCREMENT BY 1;
CREATE SEQUENCE SEQ_TRANSACTIONSPK START WITH 1
INCREMENT BY 1;

INSERT INTO ADMIN_ACCOUNTS
(ID_ADM, EMAIL, SENHA)
VALUES
(1, 'eduardo.fg1@puccampinas.edu.br', 'Eduardo64!');

INSERT INTO ADMIN_ACCOUNTS
(ID_ADM, EMAIL, SENHA)
VALUES
(2, 'gabriel.ac13@puccampinas.edu.br', 'Capovilla123$');

INSERT INTO WALLETS
(ID_CRT, SALDO)
VALUES
(SEQ_WALLETSPK.NEXTVAL, 0);

INSERT INTO ACCOUNTS
(ID_USR,NOME,EMAIL,SENHA,DATA_NASC,TOKEN,FK_ID_CRT)
VALUES
(SEQ_ACCOUNTSPK.NEXTVAL,'Eduardo Ferreira Gomes','dududuefu.gomes@gmail.com',
'$2a$10$8vf1zx68jaMLIm4zHCLKo.jBGYXUMNz8luYGSrx88IHqRDOPHIwDS',
TO_DATE('2005-09-23', 'YYYY-MM-DD'),dbms_random.string('x',32),SEQ_WALLETSFK.NEXTVAL);

INSERT INTO EVENTS
(ID_EVT, FK_ID_USR, TITULO, DESCRICAO, CATEGORIA, DATA_INICIO, DATA_FIM, DATA_EVT, STATUS, VALOR_COTA)
VALUES
(SEQ_EVENTSPK.NEXTVAL, 1, 'Botafogo irá ganhar o brasileirão', 'O Botafogo irá ganhar o campeonato brasileiro de 2024?', 'Futebol', 
TO_DATE('2024-12-04', 'yyyy-mm-dd'), 
TO_DATE('2024-12-07', 'yyyy-mm-dd'), 
TO_DATE('2024-12-08', 'yyyy-mm-dd'), 
'aprovado', 2.50);

COMMIT;